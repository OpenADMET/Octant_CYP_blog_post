project:
  output-dir: _site
  render:
    - cyp-blog-post.qmd
  resources:
    - post/assets/openadmet-logo.png
    - post/figures/banner_drc_animation.gif
format:
  html:
    theme:
      - lux
      - post/styles.css
    grid:
      body-width: 850px
    toc: true
    toc-location: left
    toc-expand: 2
    toc-depth: 4
    smooth-scroll: true
    number-sections: false
    lightbox: true
    include-before-body:
      - text: |
          <div class="progress-header">
            <a href="https://openadmet.ghost.io/"><img src="post/assets/openadmet-logo.png" alt="OpenADMET" class="progress-header-logo"></a>
            <span class="progress-header-title">Building the OpenADMET Data Engine</span>
            <div class="reading-progress-track"><div class="reading-progress-fill"></div></div>
          </div>
          <a href="https://openadmet.ghost.io/"><img src="post/assets/openadmet-logo.png" alt="OpenADMET logo" class="header-logo"></a>
    include-after-body:
      - text: |
          <script>
            // Enable ToC figure entries after first scroll (keeps ToC clean on load)
            window.addEventListener('scroll', function() {
              document.body.classList.add('toc-scrolled');
            }, { once: true });

            // Progress header: show after scrolling past hero, update progress bar
            (function() {
              var header = document.querySelector('.progress-header');
              var fill = document.querySelector('.reading-progress-fill');
              var tocSidebar = document.getElementById('quarto-sidebar-toc-left');
              if (!header || !fill) return;
              var threshold = 300; // px before header appears
              window.addEventListener('scroll', function() {
                var scrollTop = window.scrollY;
                var docHeight = document.documentElement.scrollHeight - window.innerHeight;
                var pct = docHeight > 0 ? Math.min(scrollTop / docHeight * 100, 100) : 0;
                fill.style.width = pct + '%';
                var past = scrollTop > threshold;
                header.classList.toggle('visible', past);
                if (tocSidebar) tocSidebar.classList.toggle('toc-visible', past);
              });
            })();

            // Copy figure captions into lightbox descriptions
            document.querySelectorAll('.figure-caption').forEach(function(cap) {
              var prev = cap.previousElementSibling;
              if (!prev) return;
              var link = prev.querySelector('a.lightbox');
              if (!link) return;
              link.setAttribute('data-description', cap.innerHTML);
            });

            // Inject figure captions into ggiraph fullscreen modals.
            // Pre-build SVGâ†’caption map after widgets initialize (load event),
            // because openModal() moves the SVG out of .cell before the
            // MutationObserver callback fires.
            window.addEventListener('load', function() {
              var svgCaptions = {};
              document.querySelectorAll('.ggiraph-svg').forEach(function(svg) {
                var cell = svg.closest('.cell');
                if (!cell) return;
                var sib = cell.nextElementSibling;
                while (sib && !sib.classList.contains('figure-caption')) {
                  sib = sib.nextElementSibling;
                }
                if (sib) svgCaptions[svg.id] = sib;
              });
              new MutationObserver(function(mutations) {
                mutations.forEach(function(m) {
                  m.addedNodes.forEach(function(node) {
                    if (node.nodeType !== 1) return;
                    if (!node.classList.contains('ggiraph-fullscreen-modal')) return;
                    var svgId = node.id.replace('_fullscreen_modal', '');
                    var caption = svgCaptions[svgId];
                    if (!caption) return;
                    var content = node.querySelector('.ggiraph-fullscreen-content');
                    if (!content) return;
                    var clone = caption.cloneNode(true);
                    clone.className = 'ggiraph-fullscreen-caption';
                    content.appendChild(clone);
                  });
                });
              }).observe(document.body, { childList: true });
            });
          </script>
execute:
  warning: false
knitr:
  opts_chunk:
    fig.align: "center"
    warning: false
    message: true
    collapse: true
    echo: false
    dpi: 300
